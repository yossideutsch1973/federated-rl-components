name: Debug CI

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout code
      uses: actions/checkout@v4
    
    - name: 🐍 Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    
    - name: 🔧 Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
    
    - name: 📦 Install dependencies
      run: |
        npm install
        echo "✓ Dependencies installed"
    
    - name: 🌐 Install Playwright
      run: |
        npx playwright install chromium --with-deps
        echo "✓ Playwright installed"
    
    - name: 🔍 Check script permissions
      run: |
        ls -la test/*.sh
        ls -la test/unit/*.js
    
    - name: 🧪 Run unit tests only (no E2E)
      run: |
        echo "=== Running unit tests ==="
        node test/unit/test-rl-core.js
        echo "Exit code: $?"
        
        node test/unit/test-federated-core.js
        echo "Exit code: $?"
        
        node test/unit/test-metrics-core.js
        echo "Exit code: $?"
        
        echo "=== Unit tests completed ==="
    
    - name: 🧪 Run test runner script
      run: |
        echo "=== Running test runner ==="
        chmod +x ./test/run-tests.sh
        ./test/run-tests.sh --fast
        TEST_EXIT=$?
        echo "Test runner exit code: $TEST_EXIT"
        
        if [ $TEST_EXIT -eq 0 ]; then
          echo "✅ Tests passed successfully"
          exit 0
        else
          echo "❌ Tests failed with code $TEST_EXIT"
          exit 1
        fi
    
    - name: 📊 Debug info
      if: always()
      run: |
        echo "Node version: $(node --version)"
        echo "NPM version: $(npm --version)"
        echo "Python version: $(python3 --version)"
        echo "PWD: $(pwd)"
        echo "Files:"
        ls -la

